<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USAHUDhomes - Diagnostic Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .status {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { border-left: 4px solid #10b981; }
        .error { border-left: 4px solid #ef4444; }
        .warning { border-left: 4px solid #f59e0b; }
        h1 { color: #1f2937; }
        h2 { color: #374151; font-size: 18px; margin-top: 0; }
        pre {
            background: #f9fafb;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .loading {
            text-align: center;
            padding: 40px;
        }
    </style>
</head>
<body>
    <h1>üîç USAHUDhomes Diagnostic Test</h1>
    
    <div id="loading" class="loading">
        <p>Running diagnostics...</p>
    </div>
    
    <div id="results"></div>

    <script type="module">
        const results = document.getElementById('results');
        const loading = document.getElementById('loading');
        
        function addStatus(title, message, type = 'success', details = null) {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `
                <h2>${title}</h2>
                <p>${message}</p>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            results.appendChild(div);
        }

        async function runDiagnostics() {
            try {
                // Test 1: Check if we're running
                addStatus('‚úÖ JavaScript Execution', 'JavaScript is running successfully', 'success');

                // Test 2: Check environment variables
                const supabaseUrl = 'https://lpqjndfjbenolhneqzec.supabase.co';
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxwcWpuZGZqYmVub2xobmVxemVjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY3MzY1NzAsImV4cCI6MjA1MjMxMjU3MH0.ORqXGLJTLvOJJCqBDMzqIjqcPqbEOXqgZcPpGhEVCJE';
                
                if (supabaseUrl && supabaseKey) {
                    addStatus('‚úÖ Configuration', 'Supabase credentials are configured', 'success', 
                        `URL: ${supabaseUrl}\nKey: ${supabaseKey.substring(0, 20)}...`);
                } else {
                    addStatus('‚ùå Configuration', 'Supabase credentials are missing', 'error');
                }

                // Test 3: Test Supabase connection
                addStatus('üîÑ Testing Connection', 'Attempting to connect to Supabase...', 'warning');
                
                const response = await fetch(`${supabaseUrl}/rest/v1/`, {
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': `Bearer ${supabaseKey}`
                    }
                });

                if (response.ok) {
                    addStatus('‚úÖ Supabase Connection', 'Successfully connected to Supabase', 'success',
                        `Status: ${response.status}\nURL: ${supabaseUrl}`);
                } else {
                    addStatus('‚ùå Supabase Connection', 'Failed to connect to Supabase', 'error',
                        `Status: ${response.status}\nResponse: ${await response.text()}`);
                }

                // Test 4: Test properties table
                try {
                    const propertiesResponse = await fetch(`${supabaseUrl}/rest/v1/properties?select=count`, {
                        headers: {
                            'apikey': supabaseKey,
                            'Authorization': `Bearer ${supabaseKey}`,
                            'Prefer': 'count=exact'
                        }
                    });

                    if (propertiesResponse.ok) {
                        const count = propertiesResponse.headers.get('content-range');
                        addStatus('‚úÖ Database Access', 'Successfully accessed properties table', 'success',
                            `Properties count: ${count || 'Unknown'}`);
                    } else {
                        addStatus('‚ö†Ô∏è Database Access', 'Could not access properties table', 'warning',
                            `Status: ${propertiesResponse.status}`);
                    }
                } catch (err) {
                    addStatus('‚ö†Ô∏è Database Access', 'Error accessing database', 'warning', err.message);
                }

                // Test 5: Check DOM
                const rootElement = document.getElementById('root');
                if (rootElement) {
                    addStatus('‚úÖ DOM Ready', 'Root element exists in DOM', 'success');
                } else {
                    addStatus('‚ùå DOM Ready', 'Root element not found', 'error');
                }

                // Test 6: Browser info
                addStatus('‚ÑπÔ∏è Browser Info', 'Browser details', 'success',
                    `User Agent: ${navigator.userAgent}\n` +
                    `Platform: ${navigator.platform}\n` +
                    `Language: ${navigator.language}`
                );

            } catch (error) {
                addStatus('‚ùå Fatal Error', 'An error occurred during diagnostics', 'error',
                    `${error.name}: ${error.message}\n${error.stack}`);
            } finally {
                loading.style.display = 'none';
            }
        }

        // Run diagnostics when page loads
        runDiagnostics();
    </script>
</body>
</html>
